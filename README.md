# serializer

Описание инструмента для бинарной сериализации и десериализации данных с контролем версий.

## Задача

Нужно сформулировать высокоуровневый подход к заданию форматов структур предназначенных для сериализации и десериализации из бинарного формата с по возможностью прозрачным контролем их версий.

## Идеи

### Поколения

* Все изменения, такие как создания объектов, добавление или удаления полей в них и т.п. производятся в рамках т.н. поколений.
* При изменении структуры в рамках поколения необходимо вручную, в рамках определённых соглашений, написать
    * функцию-апгрейд, делающую преобразование из данной структуры в предыдущем поколении в данную структуру в текущем
    * функцию-даунгрейд, делающую преобразование из данной структуры в текущем поколении в её состояние из предыдущего поколения
    
По-видимому, проще всего будет организовывать поколения в виде специальным образом именованных файлов. Предлагаю следующее:

Файлики должны выглядеть как 

```
<префикс>_<номер>.vsl
```


| wal_00.vsl | wal_01.vsl | ... | wal_10.vsl  |
|------------|------------|-----|-------------|

Для удобства предлагаю жёстко привязывать номер поколения к номеру в файле, начиная с нуля. Утилитка генерирующая код должна это проверять.

### Сериализация

* Идентификатор. У каждой структуры, у каждой её версии должен быть некий идентификатор. Предлагаю вычислять его как значение хеш-функции от
    * имени, если структура только объявлена в данном поколении или брать идентификатор данной структуры в предыдущем поколении
    * по (+, имя, тип) добавляемого поля
    * по (-, имя, тип) удаляемого поля
    
* Нужна высокая скорость сериализации
* Нужно хорошее сжатие. Предлагаю минимум метаинформации.
